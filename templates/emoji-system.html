/**
 * ðŸŽ¨ EMOJI TO IMAGE SYSTEM
 * Sistema para reemplazar emojis con imÃ¡genes personalizadas
 * Uso: defineEmojiImage('ðŸ’°', '/path/to/image.png')
 */

<style>
    /* Clase para imÃ¡genes que reemplazan emojis */
    .emoji-img {
        display: inline-block;
        width: 1.2em;
        height: 1.2em;
        vertical-align: middle;
        object-fit: contain;
        margin: -0.1em 0.1em;
    }

    .emoji-img.large {
        width: 2em;
        height: 2em;
    }

    .emoji-img.medium {
        width: 1.5em;
        height: 1.5em;
    }

    .emoji-img.small {
        width: 1em;
        height: 1em;
    }
</style>

<script>
/**
 * ConfiguraciÃ³n de emojis a imÃ¡genes
 * Mapea emojis Unicode a URLs de imÃ¡genes
 */
const EMOJI_IMAGE_MAP = {
    // Monedas y dinero
    'ðŸ’°': null,  // Configurar con: setEmojiImage('ðŸ’°', '/static/images/money-bag.png')
    'ðŸ’µ': null,
    'ðŸ’´': null,
    'ðŸ’¶': null,
    'ðŸ’·': null,
    'ðŸª™': null,

    // VerificaciÃ³n y estado
    ': null,
    ': null,
    'âœ“': null,
    'âœ”': null,
    'âš ï¸': null,
    'â³': null,

    // CelebraciÃ³n y Ã©xito
    'ðŸŽ‰': null,
    'ðŸŽŠ': null,
    'ðŸ¥³': null,
    'ðŸ†': null,
    'ðŸŒŸ': null,
    'â­': null,
    'ðŸ’Ž': null,
    'ðŸ‘‘': null,

    // TecnologÃ­a
    'ðŸ“±': null,
    'ðŸ’»': null,
    'ðŸ”—': null,
    'âš¡': null,
    'ðŸ”‹': null,

    // InformaciÃ³n
    'ðŸ“Š': null,
    'ðŸ“ˆ': null,
    'ðŸ“‰': null,
    'ðŸ“‹': null,
    'ðŸ“„': null,
    'ðŸ“œ': null,
    'â„¹ï¸': null,
    'ðŸ’¡': null,

    // Otros comunes
    'ðŸŽ': null,
    'ðŸŽ¯': null,
    'ðŸš€': null,
    'âš™ï¸': null,
    'ðŸ”’': null,
    'ðŸ”“': null
};

/**
 * Define una imagen para un emoji especÃ­fico
 * @param {string} emoji - El emoji a reemplazar
 * @param {string} imageUrl - URL de la imagen
 */
function setEmojiImage(emoji, imageUrl) {
    EMOJI_IMAGE_MAP[emoji] = imageUrl;
}

/**
 * Define mÃºltiples emojis a la vez
 * @param {Object} mapping - Objeto con emoji: url
 */
function setEmojiImages(mapping) {
    Object.assign(EMOJI_IMAGE_MAP, mapping);
}

/**
 * Reemplaza emojis por imÃ¡genes en un elemento
 * @param {HTMLElement|string} element - Elemento o selector
 * @param {string} size - TamaÃ±o: 'small', 'medium', 'large', null (default)
 */
function replaceEmojisInElement(element, size = null) {
    const el = typeof element === 'string' ? document.querySelector(element) : element;
    if (!el) return;

    // Procesar nodos de texto
    const walker = document.createTreeWalker(
        el,
        NodeFilter.SHOW_TEXT,
        null,
        false
    );

    const nodesToReplace = [];
    let node;

    while (node = walker.nextNode()) {
        if (node.textContent.trim()) {
            nodesToReplace.push(node);
        }
    }

    nodesToReplace.forEach(textNode => {
        let html = textNode.textContent;
        let hasEmoji = false;

        // Reemplazar cada emoji configurado
        for (const [emoji, imageUrl] of Object.entries(EMOJI_IMAGE_MAP)) {
            if (imageUrl && html.includes(emoji)) {
                const sizeClass = size ? ` ${size}` : '';
                html = html.replace(
                    new RegExp(escapeRegExp(emoji), 'g'),
                    `<img src="${imageUrl}" alt="${emoji}" class="emoji-img${sizeClass}" />`
                );
                hasEmoji = true;
            }
        }

        if (hasEmoji) {
            const span = document.createElement('span');
            span.innerHTML = html;
            textNode.parentNode.replaceChild(span, textNode);
        }
    });
}

/**
 * Reemplaza emojis en todo el documento
 * @param {string} size - TamaÃ±o de las imÃ¡genes
 */
function replaceAllEmojis(size = null) {
    replaceEmojisInElement(document.body, size);
}

/**
 * Observa cambios en el DOM y reemplaza emojis automÃ¡ticamente
 * @param {string} size - TamaÃ±o de las imÃ¡genes
 */
function autoReplaceEmojis(size = null) {
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            mutation.addedNodes.forEach((node) => {
                if (node.nodeType === 1) { // Element node
                    replaceEmojisInElement(node, size);
                }
            });
        });
    });

    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
}

/**
 * Crea un elemento con texto que tiene emojis reemplazados
 * @param {string} text - Texto con emojis
 * @param {string} tag - Tag HTML (default: 'span')
 * @param {string} size - TamaÃ±o de emojis
 * @returns {HTMLElement}
 */
function createElementWithEmojis(text, tag = 'span', size = null) {
    const element = document.createElement(tag);
    element.textContent = text;
    replaceEmojisInElement(element, size);
    return element;
}

/**
 * Convierte texto con emojis a HTML con imÃ¡genes
 * @param {string} text - Texto con emojis
 * @param {string} size - TamaÃ±o de emojis
 * @returns {string} HTML
 */
function emojiTextToHtml(text, size = null) {
    let html = text;
    const sizeClass = size ? ` ${size}` : '';

    for (const [emoji, imageUrl] of Object.entries(EMOJI_IMAGE_MAP)) {
        if (imageUrl && html.includes(emoji)) {
            html = html.replace(
                new RegExp(escapeRegExp(emoji), 'g'),
                `<img src="${imageUrl}" alt="${emoji}" class="emoji-img${sizeClass}" />`
            );
        }
    }

    return html;
}

/**
 * Escapa caracteres especiales para RegExp
 * @param {string} string - String a escapar
 * @returns {string}
 */
function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

// Exponer funciones globalmente
window.setEmojiImage = setEmojiImage;
window.setEmojiImages = setEmojiImages;
window.replaceEmojisInElement = replaceEmojisInElement;
window.replaceAllEmojis = replaceAllEmojis;
window.autoReplaceEmojis = autoReplaceEmojis;
window.createElementWithEmojis = createElementWithEmojis;
window.emojiTextToHtml = emojiTextToHtml;

// Auto-inicializar cuando el DOM estÃ© listo
document.addEventListener('DOMContentLoaded', function() {
    // Puedes activar el auto-reemplazo descomentan esta lÃ­nea:
    // autoReplaceEmojis();
});

/**
 * EJEMPLO DE USO:
 *
 * 1. Configurar imÃ¡genes para emojis:
 *    setEmojiImage('ðŸ’°', '/static/images/money-bag.png');
 *    setEmojiImage('âœ…', '/static/images/checkmark.png');
 *
 * 2. O configurar mÃºltiples a la vez:
 *    setEmojiImages({
 *        'ðŸ’°': '/static/images/money-bag.png',
 *        ': '/static/images/checkmark.png',
 *        ': '/static/images/cross.png'
 *    });
 *
 * 3. Reemplazar emojis en un elemento especÃ­fico:
 *    replaceEmojisInElement('#mi-elemento');
 *    replaceEmojisInElement(document.querySelector('.clase'), 'large');
 *
 * 4. Reemplazar en todo el documento:
 *    replaceAllEmojis();
 *
 * 5. Activar reemplazo automÃ¡tico:
 *    autoReplaceEmojis('medium');
 *
 * 6. Convertir texto a HTML:
 *    const html = emojiTextToHtml('Â¡Wallet vinculada âœ…!');
 */
</script>
